import{_ as ye}from"./index-7c84244e.js";import{f as A,a as X}from"./format-bc53a88b.js";import{u as ke,v as J,c as he,a as we}from"./clipboard-bc3ba9ce.js";/* empty css              *//* empty css              *//* empty css              */import{L as Ie,K as be,r as k,c as f,a as xe,l as Te,B as n,C as i,D as s,j as a,M as r,R as $,N as U,O as v,H as p,F as K,u as M,P as Ce,Q as ze,t as _}from"./vendor-b4f2d831.js";import{s as u,a as Me,N as Pe,P as Be,B as Ue,T as je,b as De,I as Ne,L as Re}from"./vant-eb5bb9af.js";import"./utils-917b1704.js";const Le={class:"video-preview-page"},Ee={class:"nav-actions"},Ze={class:"page-content"},Ae={class:"status-section animate-fade-in-up"},Ve={class:"status-content"},We={class:"status-main"},Se={class:"status-icon"},Ge={key:1,class:"success-icon"},Oe={key:2,class:"error-icon"},He={key:3,class:"pending-icon"},Qe={class:"status-text"},Ye={key:0,class:"progress-section"},Fe={class:"progress-info"},Xe={class:"progress-text"},Je={class:"status-actions"},$e={key:0,class:"video-info-section animate-fade-in-up"},Ke={class:"video-card card-floating"},qe={class:"video-thumbnail"},et={class:"thumbnail-container"},tt=["src"],st=["src","alt"],at={class:"play-overlay"},ot={class:"play-button glow-effect"},nt={key:2,class:"duration-badge"},lt={class:"platform-badge"},it={class:"video-details"},rt={class:"video-title"},ct={class:"video-meta"},ut={class:"meta-row"},dt={class:"meta-item"},vt={key:0,class:"meta-item"},pt={class:"meta-row"},_t={key:0,class:"meta-item"},mt={key:1,class:"meta-item"},ft={key:0,class:"video-description"},gt={key:1,class:"video-tags"},yt={class:"action-section animate-fade-in-up"},kt={key:0,class:"action-buttons"},ht={key:1,class:"processing-info"},wt={class:"processing-card card-glass"},It={key:2,class:"error-info"},bt={class:"error-card card-floating"},xt={key:1,class:"transcription-section animate-fade-in-up"},Tt={class:"transcription-card card-floating"},Ct={class:"transcription-header"},zt={class:"transcription-content"},Mt={class:"text-card original-text"},Pt={class:"text-header"},Bt={class:"text-content"},Ut={class:"text-meta"},jt={key:0,class:"text-card optimized-text"},Dt={class:"text-header"},Nt={class:"text-content"},Rt={class:"transcription-actions"},Lt={key:2,class:"error-section animate-fade-in-up"},q="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDMyMCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMjAiIGhlaWdodD0iMTgwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMzYgNzJIMTg0VjEwOEgxMzZWNzJaIiBmaWxsPSIjOUI5QjlCIi8+CjxwYXRoIGQ9Ik0xNTIgODRWOTZMMTY4IDkwTDE1MiA4NFoiIGZpbGw9IndoaXRlIi8+Cjx0ZXh0IHg9IjE2MCIgeT0iMTMwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOUI5QjlCIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiPuinhumikea1i+WkseaViTwvdGV4dD4KPC9zdmc+",Et={__name:"VideoPreview",setup(Zt){const ee=Ie(),V=be(),d=ke(),h=k(ee.params.taskId),j=k(!1),D=k(!1),N=k(!1),P=k(!1),R=k(!1),L=k(!1),T=k(""),g=k(null),x=k(""),l=f(()=>d.currentTask),W=f(()=>d.currentProgress),w=f(()=>d.isProcessing),I=f(()=>d.isCompleted),b=f(()=>d.isFailed),c=f(()=>{var t;return(t=l.value)==null?void 0:t.videoInfo}),S=f(()=>{var t;return(t=l.value)==null?void 0:t.platform}),te=f(()=>w.value?"解析中":I.value?"解析完成":b.value?"解析失败":"视频预览"),se=f(()=>w.value?"status-processing":I.value?"status-completed":b.value?"status-failed":"status-pending"),ae=f(()=>w.value?"正在解析视频":I.value?"解析完成":b.value?"解析失败":"等待处理"),oe=f(()=>{var t;return w.value?"请耐心等待，正在为您处理视频...":I.value?"视频已准备就绪，您可以下载或转换文案":b.value?((t=l.value)==null?void 0:t.errorMessage)||"处理过程中出现错误，请重试":"任务已创建，即将开始处理"}),ne=()=>{V.back()},G=async()=>{var t;if(h.value){j.value=!0;try{await d.refreshTaskStatus(h.value),((t=l.value)==null?void 0:t.status)==="completed"&&await Q(),u("状态已刷新")}catch(e){console.error("刷新状态失败:",e),u("刷新失败")}finally{j.value=!1}}},le=async()=>{if(l.value){D.value=!0;try{await d.downloadVideo(l.value.taskId),u("下载开始")}catch(t){console.error("下载失败:",t),u("下载失败，请重试")}finally{D.value=!1}}},ie=async()=>{if(l.value){N.value=!0;try{const t=await d.transcribeVideo(l.value.taskId);g.value=t,u("文案提取完成")}catch(t){console.error("转文案失败:",t),u("转文案失败，请重试")}finally{N.value=!1}}},O=async()=>{if(l.value){P.value=!0;try{await d.retryTask(l.value.taskId),u("重新开始处理")}catch(t){console.error("重试失败:",t),u("重试失败，请稍后再试")}finally{P.value=!1}}},H=async()=>{if(l.value)try{await Me({title:"确认取消",message:"确定要取消当前任务吗？这将删除已缓存的视频文件，且无法恢复。",confirmButtonText:"确认取消",cancelButtonText:"继续等待",confirmButtonColor:"#ef4444"}),R.value=!0,await d.cancelTask(l.value.taskId),u("任务已取消"),V.replace("/")}catch(t){t!=="cancel"&&(console.error("取消任务失败:",t),u("取消失败，请重试"))}finally{R.value=!1}},re=async()=>{var t;if((t=g.value)!=null&&t.text){L.value=!0;try{const e=await d.optimizeText(g.value.text);x.value=e.optimizedText,u("AI优化完成")}catch(e){console.error("AI优化失败:",e),u("AI优化失败，请重试")}finally{L.value=!1}}},E=async t=>{try{await he(t),u("已复制到剪贴板")}catch{u("复制失败")}},ce=async t=>{if(navigator.share)try{await navigator.share({title:"视频文案",text:t})}catch{E(t)}else E(t)},ue=t=>{try{const e=new Blob([t],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(e),y=document.createElement("a");y.href=o,y.download=`视频文案_${new Date().getTime()}.txt`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(o),u("文案已导出")}catch(e){console.error("导出失败:",e),u("导出失败")}},de=()=>{T.value=""},Q=async()=>{if(h.value)try{console.log("加载预览信息...");const t=await we.getVideoPreview(h.value);console.log("预览信息响应:",t),l.value&&t&&t.data&&(console.log("预览URL:",t.data.previewUrl),d.currentTask&&(d.currentTask.previewUrl=t.data.previewUrl,d.currentTask.downloadUrl=t.data.downloadUrl,d.currentTask.fileInfo=t.data.fileInfo,console.log("已直接更新taskStore.currentTask")),console.log("更新后的任务信息:",l.value))}catch(t){console.error("加载预览信息失败:",t)}},ve=()=>{var o,y,C,B,m;const t=((o=l.value)==null?void 0:o.previewUrl)||((C=(y=l.value)==null?void 0:y.videoInfo)==null?void 0:C.previewUrl),e=(m=(B=l.value)==null?void 0:B.videoInfo)==null?void 0:m.thumbnail;return console.log("获取预览图片:",{previewUrl:t,thumbnail:e,currentTask:l.value}),t||e||q},pe=t=>{t.target.src.includes("placeholder-video.jpg")||t.target.src.includes("data:image/svg+xml")||t.target.dataset.errorHandled||(t.target.dataset.errorHandled="true",t.target.src=q)},_e=t=>{console.error("视频加载失败:",t),u("视频加载失败，请重试")},me=t=>({douyin:"抖音",bilibili:"哔哩哔哩",youtube:"YouTube",tiktok:"TikTok"})[t]||t,fe=t=>({douyin:"#ff0050",bilibili:"#00a1d6",youtube:"#ff0000",tiktok:"#000000"})[t]||"#667eea";return xe(async()=>{var t;if(console.log("VideoPreview mounted, taskId:",h.value),h.value){J.setCurrentTask(h.value);try{const e=await d.restoreTaskFromStorage(h.value);console.log("恢复的任务:",e),!l.value||!l.value.taskId?(console.log("没有当前任务，开始刷新状态"),await G()):console.log("已有任务数据:",l.value),((t=l.value)==null?void 0:t.status)==="completed"&&await Q()}catch(e){console.error("初始化任务失败:",e),T.value="加载任务失败，请刷新页面重试"}}else T.value="无效的任务ID"}),Te(()=>{J.setShouldCleanOnUnload(!1)}),(t,e)=>{var Y,F;const o=Ne,y=Pe,C=Re,B=Be,m=Ue,Z=je,ge=De;return n(),i("div",Le,[e[22]||(e[22]=s("div",{class:"bg-decoration"},[s("div",{class:"decoration-circle circle-1"}),s("div",{class:"decoration-circle circle-2"})],-1)),a(y,{title:te.value,"left-arrow":"",fixed:"",placeholder:"",class:"nav-bar glass-nav",onClickLeft:ne},{right:r(()=>[s("div",Ee,[a(o,{name:"replay",size:"18",onClick:G,class:$([{spinning:j.value},"nav-action-btn"])},null,8,["class"]),a(o,{name:"delete-o",size:"18",onClick:H,class:"nav-action-btn cancel-btn"})])]),_:1},8,["title"]),s("div",Ze,[s("div",Ae,[s("div",{class:$(["status-card card-floating",se.value])},[s("div",Ve,[s("div",We,[s("div",Se,[w.value?(n(),U(C,{key:0,size:"32px",color:"white"})):I.value?(n(),i("div",Ge,[a(o,{name:"checked",size:"32px"})])):b.value?(n(),i("div",Oe,[a(o,{name:"close",size:"32px"})])):(n(),i("div",He,[a(o,{name:"clock",size:"32px"})]))]),s("div",Qe,[s("h3",null,v(ae.value),1),s("p",null,v(oe.value),1)])]),w.value?(n(),i("div",Ye,[a(B,{percentage:W.value,"stroke-width":"8",color:"rgba(255,255,255,0.9)","track-color":"rgba(255,255,255,0.2)",class:"progress-bar"},null,8,["percentage"]),s("div",Fe,[s("span",Xe,v(W.value)+"%",1),e[3]||(e[3]=s("span",{class:"progress-detail"},"正在处理视频...",-1))])])):p("",!0),s("div",Je,[I.value?p("",!0):(n(),U(m,{key:0,size:"small",type:"danger",class:"btn-glass",onClick:H,loading:R.value},{icon:r(()=>[a(o,{name:"cross"})]),default:r(()=>[e[4]||(e[4]=_(" 取消任务 "))]),_:1,__:[4]},8,["loading"])),b.value?(n(),U(m,{key:1,size:"small",type:"primary",class:"btn-glass",onClick:O,loading:P.value},{icon:r(()=>[a(o,{name:"replay"})]),default:r(()=>[e[5]||(e[5]=_(" 重新尝试 "))]),_:1,__:[5]},8,["loading"])):p("",!0)])])],2)]),c.value?(n(),i("div",$e,[s("div",Ke,[s("div",qe,[s("div",et,[(Y=l.value)!=null&&Y.previewUrl?(n(),i("video",{key:0,src:l.value.previewUrl,controls:"",preload:"metadata",class:"video-player",onError:_e}," 您的浏览器不支持视频播放 ",40,tt)):(n(),i(K,{key:1},[s("img",{src:ve(),alt:((F=c.value)==null?void 0:F.title)||"视频预览",onError:pe,class:"thumbnail-image"},null,40,st),s("div",at,[s("div",ot,[a(o,{name:"play-circle",size:"64px"})])])],64)),c.value.duration?(n(),i("div",nt,v(M(A)(c.value.duration)),1)):p("",!0),s("div",lt,[s("span",{style:Ce({color:fe(S.value)})},v(me(S.value)),5)])])]),s("div",it,[s("h2",rt,v(c.value.title||"解析中..."),1),s("div",ct,[s("div",ut,[s("div",dt,[a(o,{name:"user-o"}),s("span",null,v(c.value.author||"未知作者"),1)]),c.value.viewCount?(n(),i("div",vt,[a(o,{name:"eye-o"}),s("span",null,v(M(X)(c.value.viewCount))+" 次播放",1)])):p("",!0)]),s("div",pt,[c.value.likeCount?(n(),i("div",_t,[a(o,{name:"like-o"}),s("span",null,v(M(X)(c.value.likeCount))+" 点赞",1)])):p("",!0),c.value.duration?(n(),i("div",mt,[a(o,{name:"clock-o"}),s("span",null,v(M(A)(c.value.duration)),1)])):p("",!0)])]),c.value.description?(n(),i("div",ft,[e[6]||(e[6]=s("h4",null,"视频描述",-1)),s("p",null,v(c.value.description),1)])):p("",!0),c.value.tags&&c.value.tags.length?(n(),i("div",gt,[(n(!0),i(K,null,ze(c.value.tags.slice(0,5),z=>(n(),U(Z,{key:z,size:"mini",class:"tag-item"},{default:r(()=>[_(v(z),1)]),_:2},1024))),128))])):p("",!0)])])])):p("",!0),s("div",yt,[I.value?(n(),i("div",kt,[a(m,{type:"primary",size:"large",class:"action-btn download-btn btn-primary",onClick:le,loading:D.value},{icon:r(()=>[a(o,{name:"down"})]),default:r(()=>[e[7]||(e[7]=_(" 下载视频 "))]),_:1,__:[7]},8,["loading"]),a(m,{type:"success",size:"large",class:"action-btn transcribe-btn btn-accent",onClick:ie,loading:N.value},{icon:r(()=>[a(o,{name:"volume-o"})]),default:r(()=>[e[8]||(e[8]=_(" 转换文案 "))]),_:1,__:[8]},8,["loading"])])):w.value?(n(),i("div",ht,[s("div",wt,[a(C,{size:"24px",color:"#667eea"}),e[9]||(e[9]=s("span",null,"正在处理视频，请耐心等待...",-1))])])):b.value?(n(),i("div",It,[s("div",bt,[a(o,{name:"warning-o",size:"24px",color:"#ef4444"}),e[11]||(e[11]=s("span",null,"处理失败，请重试或返回重新选择视频",-1)),a(m,{type:"warning",size:"small",onClick:O,loading:P.value},{default:r(()=>e[10]||(e[10]=[_(" 重新尝试 ")])),_:1,__:[10]},8,["loading"])])])):p("",!0)]),g.value?(n(),i("div",xt,[s("div",Tt,[s("div",Ct,[s("h3",null,[a(o,{name:"chat-o"}),e[12]||(e[12]=_(" 提取的文案 "))]),a(m,{size:"small",type:"primary",class:"btn-glass",onClick:re,loading:L.value},{default:r(()=>[a(o,{name:"fire"}),e[13]||(e[13]=_(" AI优化 "))]),_:1,__:[13]},8,["loading"])]),s("div",zt,[s("div",Mt,[s("div",Pt,[e[15]||(e[15]=s("h4",null,"原始文案",-1)),a(Z,{size:"mini",color:"#f3f4f6","text-color":"#6b7280"},{default:r(()=>e[14]||(e[14]=[_("原始")])),_:1,__:[14]})]),s("div",Bt,[s("p",null,v(g.value.text),1),s("div",Ut,[s("span",null,"时长: "+v(M(A)(g.value.duration)),1),s("span",null,v(g.value.createTime|t.formatDate),1)])])]),x.value?(n(),i("div",jt,[s("div",Dt,[e[17]||(e[17]=s("h4",null,"AI优化文案",-1)),a(Z,{size:"mini",type:"success"},{default:r(()=>e[16]||(e[16]=[_("优化")])),_:1,__:[16]})]),s("div",Nt,[s("p",null,v(x.value),1),e[18]||(e[18]=s("div",{class:"text-meta"},[s("span",null,"由AI智能优化")],-1))])])):p("",!0)]),s("div",Rt,[a(m,{class:"btn-glass",onClick:e[0]||(e[0]=z=>E(x.value||g.value.text))},{icon:r(()=>[a(o,{name:"copy"})]),default:r(()=>[e[19]||(e[19]=_(" 复制文案 "))]),_:1,__:[19]}),a(m,{class:"btn-glass",onClick:e[1]||(e[1]=z=>ce(x.value||g.value.text))},{icon:r(()=>[a(o,{name:"share"})]),default:r(()=>[e[20]||(e[20]=_(" 分享 "))]),_:1,__:[20]}),a(m,{class:"btn-glass",onClick:e[2]||(e[2]=z=>ue(x.value||g.value.text))},{icon:r(()=>[a(o,{name:"down"})]),default:r(()=>[e[21]||(e[21]=_(" 导出 "))]),_:1,__:[21]})])])])):p("",!0),T.value?(n(),i("div",Lt,[a(ge,{type:"danger",text:T.value,"left-icon":"warning-o",onClick:de,class:"error-notice"},null,8,["text"])])):p("",!0)])])}}},Ft=ye(Et,[["__scopeId","data-v-4143fa3f"]]);export{Ft as default};
//# sourceMappingURL=VideoPreview-8cbb615b.js.map
